# Настройка проброса портов (Port Forwarding) в роутере

## Проблема
Ваш сервер находится за роутером:
- **Локальный IP сервера:** 192.168.3.61
- **Внешний IP роутера:** 46.191.230.86

Нужно настроить проброс портов, чтобы внешние запросы на порт 80 перенаправлялись на ваш сервер.

## Шаги настройки:

### 1. Зайдите в настройки роутера

1. Откройте браузер
2. Введите адрес роутера (обычно один из):
   - `192.168.1.1`
   - `192.168.0.1`
   - `192.168.3.1` (судя по вашему IP)
   - `10.0.0.1`
3. Войдите (логин/пароль обычно на наклейке роутера)

### 2. Найдите раздел проброса портов

Ищите один из разделов:
- **"Port Forwarding"** (Проброс портов)
- **"Виртуальные серверы"**
- **"NAT"** → **"Port Forwarding"**
- **"Переадресация портов"**
- **"Перенаправление портов"**

### 3. Добавьте правило проброса портов

**Для порта 80 (HTTP):**
- **Название/Имя:** `Web Server` или `HTTP`
- **Внешний порт:** `80`
- **Внутренний IP:** `192.168.3.61` (IP вашего сервера)
- **Внутренний порт:** `80`
- **Протокол:** `TCP` (или `TCP/UDP`)
- **Включено:** `Да` / `Enabled`

**Для порта 443 (HTTPS, если будете использовать SSL):**
- **Название/Имя:** `HTTPS`
- **Внешний порт:** `443`
- **Внутренний IP:** `192.168.3.61`
- **Внутренний порт:** `443`
- **Протокол:** `TCP`
- **Включено:** `Да`

### 4. Сохраните настройки

Нажмите **"Сохранить"** или **"Применить"**

### 5. Проверьте работу

Подождите 1-2 минуты и попробуйте открыть:
- http://sybota.space
- http://46.191.230.86

## Примеры для разных роутеров:

### TP-Link:
1. **Advanced** → **NAT Forwarding** → **Virtual Servers**
2. **Add** → Заполните поля → **Save**

### ASUS:
1. **WAN** → **Virtual Server / Port Forwarding**
2. **Enable Port Forwarding: Yes**
3. Заполните поля → **Apply**

### D-Link:
1. **Advanced** → **Port Forwarding**
2. **Add Rule** → Заполните → **Save Settings**

### Zyxel:
1. **Network** → **NAT** → **Port Forwarding**
2. **Add** → Заполните → **Apply**

## Важно:

1. **Убедитесь, что IP сервера статический** (не меняется):
   - В настройках роутера найдите **"DHCP"** или **"Резервирование адресов"**
   - Зарезервируйте IP `192.168.3.61` для MAC-адреса вашего сервера
   - Или настройте статический IP на самом сервере

2. **Проверьте файрвол на сервере:**
   ```bash
   # Убедитесь, что порты открыты
   sudo nft add rule inet filter input tcp dport 80 accept
   sudo nft add rule inet filter input tcp dport 443 accept
   ```

3. **После настройки подождите 1-2 минуты** - роутер применяет изменения

## Проверка после настройки:

```bash
# С другого компьютера (не с сервера)
curl -I http://46.191.230.86
curl -I http://sybota.space
```

Должен вернуться ответ от nginx, а не "Connection refused".

## Если не знаете адрес роутера:

```bash
# На сервере выполните:
ip route | grep default

# Обычно это IP шлюза (gateway)
# Например: default via 192.168.3.1 dev enp3s0
# Значит адрес роутера: 192.168.3.1
```

## Альтернатива: DMZ (не рекомендуется)

Если не можете настроить проброс портов, можно включить DMZ для IP `192.168.3.61`, но это менее безопасно.


