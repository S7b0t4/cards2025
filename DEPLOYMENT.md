# Инструкция по развертыванию в интернет

## Порты для открытия

Для работы приложения в интернете нужно открыть следующие порты на вашем сервере:

- **3003** - Frontend (Next.js)
- **3002** - Backend (NestJS)

**НЕ нужно открывать:**
- 5433 - PostgreSQL (используется только внутри Docker сети)

## Настройка файрвола

### Если используете `ufw` (Ubuntu/Debian):

```bash
sudo ufw allow 3002/tcp
sudo ufw allow 3003/tcp
sudo ufw reload
```

### Если используете `firewalld` (CentOS/RHEL):

```bash
sudo firewall-cmd --permanent --add-port=3002/tcp
sudo firewall-cmd --permanent --add-port=3003/tcp
sudo firewall-cmd --reload
```

### Если используете `iptables` напрямую:

```bash
sudo iptables -A INPUT -p tcp --dport 3002 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 3003 -j ACCEPT
sudo iptables-save
```

## Настройка для работы локально и через интернет

Приложение автоматически определяет, откуда к нему обращаются, и настраивается соответственно:

- **Локально** (localhost, 127.0.0.1, 192.168.x.x) - использует локальные адреса
- **Через интернет** (46.191.230.86) - использует внешний IP

## Переменные окружения

Вы можете переопределить URL через переменные окружения при запуске:

```bash
# Для работы через интернет (по умолчанию)
docker-compose up -d

# Для работы локально
FRONTEND_URL=http://localhost:3003 NEXT_PUBLIC_API_URL=http://localhost:3002 docker-compose up -d
```

## Доступ к приложению

После открытия портов приложение будет доступно:

- **Frontend**: http://46.191.230.86:3003
- **Backend API**: http://46.191.230.86:3002
- **API Documentation**: http://46.191.230.86:3002/api

## Проверка работы

1. Проверьте, что порты открыты:
   ```bash
   sudo netstat -tulpn | grep -E '3002|3003'
   ```

2. Проверьте доступность извне:
   ```bash
   curl http://46.191.230.86:3002
   curl http://46.191.230.86:3003
   ```

3. Откройте в браузере: http://46.191.230.86:3003

## Настройка авторизации через Telegram

Для работы первичной авторизации через Telegram необходимо:

1. **Создать Telegram бота** через [@BotFather](https://t.me/BotFather)
2. **Настроить домен** в BotFather (Telegram не работает с IP-адресами напрямую)
3. **Добавить токен бота** в переменные окружения

⚠️ **Важно:** Telegram Login Widget требует домен, а не IP. Для работы с IP 46.191.230.86 используйте один из вариантов:
- Настройте DNS для домена, указывающий на ваш IP
- Используйте ngrok для получения временного домена
- Используйте поддомен существующего домена

Подробная инструкция: см. файл `TELEGRAM_AUTH_SETUP.md`

## Безопасность

⚠️ **Важно**: 
- Убедитесь, что пароли базы данных изменены с дефолтных значений
- Рассмотрите возможность использования HTTPS (через nginx reverse proxy)
- Настройте rate limiting для защиты от DDoS
- Регулярно обновляйте зависимости
- Храните `TELEGRAM_BOT_TOKEN` и `JWT_SECRET` в безопасности

