# Улучшения системы интервального повторения

## Что было сделано

### 1. Добавлены новые поля в таблицу `card_progress`

- **correct_count** - общее количество правильных ответов
- **incorrect_count** - общее количество неправильных ответов
- **consecutive_correct** - количество последовательных правильных ответов
- **consecutive_incorrect** - количество последовательных неправильных ответов
- **success_rate** - процент успешности (правильные / всего ответов)

### 2. Улучшен алгоритм обновления прогресса

Метод `reviewCard` теперь:
- Отслеживает статистику каждого ответа
- Обновляет счетчики правильных/неправильных ответов
- Рассчитывает процент успешности
- Учитывает последовательные правильные/неправильные ответы
- Корректирует интервал повторения на основе успешности:
  - Если успешность < 50% и есть достаточно данных → интервал уменьшается на 30%
  - Если успешность > 80% и есть достаточно данных → интервал увеличивается на 10%

### 3. Улучшен алгоритм выбора карточек для практики

Метод `getCardsForReview` теперь приоритизирует карточки по следующим факторам:

1. **Низкая успешность** (weight: 3) - карточки с плохими результатами показываются чаще
2. **Высокое количество ошибок** (weight: 2) - карточки с большим количеством неправильных ответов
3. **Последовательные ошибки** (weight: 2) - недавние ошибки важнее старых
4. **Просроченность** (weight: 1) - карточки, которые давно не повторялись
5. **Низкий ease factor** (weight: 1) - более сложные карточки

**Результат:** Карточки, на которые пользователь часто отвечает неправильно, будут показываться чаще, а те, на которые отвечает правильно - реже.

## Как это работает

1. При каждом ответе на карточку система:
   - Сохраняет результат (правильно/неправильно)
   - Обновляет статистику
   - Рассчитывает новый интервал повторения

2. При загрузке карточек для практики:
   - Система выбирает карточки, у которых наступило время повторения
   - Сортирует их по приоритету (плохие результаты = выше приоритет)
   - Показывает сначала карточки с худшими результатами

## Миграция базы данных

Если автоматическая синхронизация Sequelize не сработает, можно выполнить SQL скрипт:
```bash
psql -h 192.168.3.35 -p 5433 -U postgres -d mydb -f backend/migrations/add_card_progress_stats.sql
```

Или через Docker:
```bash
docker compose exec postgres psql -U postgres -d mydb -f /app/migrations/add_card_progress_stats.sql
```

## Тестирование

После перезапуска бэкенда:
1. Система автоматически добавит новые поля в БД (если `synchronize: true`)
2. Существующие записи получат значения по умолчанию (0)
3. Новые ответы начнут накапливать статистику
4. Через несколько ответов система начнет приоритизировать карточки по успешности
