# Настройка OAuth авторизации через Telegram

## Шаг 1: Создание Telegram бота

1. Откройте Telegram и найдите бота [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям и создайте бота
4. Сохраните полученный токен (например: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)
5. **Важно:** Запомните имя бота, которое вы указали (без @)

## Шаг 2: Настройка домена для OAuth виджета

**Критически важно!** Telegram требует, чтобы домен был зарегистрирован в настройках бота.

⚠️ **Проблема:** Telegram **не принимает** `localhost` как домен через BotFather. Для локальной разработки необходимо использовать публичный домен.

### Вариант A: Использование ngrok (рекомендуется для разработки)

1. **Установите ngrok:**
   ```bash
   # Linux/Mac
   brew install ngrok
   # или скачайте с https://ngrok.com/download
   ```

2. **Запустите ngrok туннель для вашего фронтенда:**
   ```bash
   ngrok http 3003
   ```

3. **Скопируйте домен из вывода ngrok** (например: `abc123.ngrok-free.app`)

4. **Настройте домен в BotFather:**
   - Откройте [@BotFather](https://t.me/BotFather) в Telegram
   - Отправьте команду `/setdomain`
   - Выберите вашего бота из списка
   - Введите домен от ngrok **БЕЗ протокола** (например: `abc123.ngrok-free.app`)

5. **Обновите переменные окружения:**
   - Используйте ngrok URL для доступа к приложению (например: `https://abc123.ngrok-free.app`)
   - URL изменится каждый раз при перезапуске ngrok (в бесплатной версии)

### Вариант B: Production домен

Для production укажите ваш реальный домен:
- Откройте [@BotFather](https://t.me/BotFather) в Telegram
- Отправьте команду `/setdomain`
- Выберите вашего бота
- Введите домен **БЕЗ протокола** (например: `example.com` или `app.example.com`)

**Важно:** 
- Не указывайте `http://` или `https://` - только домен
- После изменения домена может потребоваться несколько минут для применения
- Для ngrok: если вы перезапускаете туннель, домен изменится и нужно будет обновить его в BotFather

## Шаг 3: Настройка переменных окружения

### Backend (.env)

Откройте файл `backend/.env` и добавьте:

```env
TELEGRAM_BOT_TOKEN=ваш_токен_от_BotFather
JWT_SECRET=ваш_секретный_ключ_для_jwt
```

### Frontend (.env.local)

Создайте файл `frontend/.env.local` и добавьте:

```env
NEXT_PUBLIC_TELEGRAM_BOT_NAME=имя_вашего_бота
NEXT_PUBLIC_API_URL=http://localhost:3002
```

**Важно:** `NEXT_PUBLIC_TELEGRAM_BOT_NAME` - это имя бота БЕЗ символа @. Например, если ваш бот называется `@myapp_bot`, то укажите `myapp_bot`.

## Шаг 4: Запуск приложения

```bash
# Для разработки (с hot reload)
docker-compose -f docker-compose.dev.yml up -d

# Или для production
docker-compose up -d --build
```

## Шаг 5: Использование

1. Откройте http://localhost:3003/auth
2. Нажмите кнопку "Login with Telegram"
3. Подтвердите авторизацию в Telegram
4. Вы автоматически войдете в систему

## Как это работает

1. Пользователь нажимает кнопку "Login with Telegram" на сайте
2. Telegram открывает окно авторизации
3. После подтверждения Telegram возвращает данные пользователя
4. Backend проверяет подлинность данных через hash
5. Если все верно - создается/находится пользователь и выдается JWT токен
6. Пользователь автоматически авторизуется

## Безопасность

- Все данные проверяются через криптографический hash
- Данные авторизации действительны только 5 минут
- JWT токен действителен 7 дней

